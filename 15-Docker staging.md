حتماً! بیایید یک مثال **Dockerfile با Multi-stage build** بسازیم و بعد توضیحش رو هم بدیم.

فرض کنیم می‌خوایم یه برنامه ساده Python بسازیم و توی تصویر نهایی فقط فایل‌های لازم برای اجرای برنامه باشه، بدون اینکه محیط توسعه یا کد منبع اضافه داخل تصویر باقی بمونه.

---

### Dockerfile نمونه با Multi-stage

```dockerfile
# ---------- Stage 1: Build ----------
FROM python:3.12-slim AS builder

# پوشه کاری
WORKDIR /app

# کپی کردن وابستگی‌ها
COPY requirements.txt .

# نصب وابستگی‌ها
RUN pip install --user -r requirements.txt

# کپی کردن کد منبع
COPY . .

# ---------- Stage 2: Final ----------
FROM python:3.12-slim

# پوشه کاری
WORKDIR /app

# فقط فایل‌های لازم از stage قبلی
COPY --from=builder /root/.local /root/.local
COPY --from=builder /app /app

# اضافه کردن مسیر pip local به PATH
ENV PATH=/root/.local/bin:$PATH

# دستور اجرا
CMD ["python", "main.py"]
```

---

### توضیح Multi-stage build

1. **Stage اول (`builder`)**

   * تمام وابستگی‌ها نصب می‌شوند و کد منبع آماده می‌شود.
   * این مرحله بزرگ است ولی برای اجرای نهایی برنامه نیاز نیست.

2. **Stage دوم (`final`)**

   * فقط فایل‌های ضروری از مرحله اول کپی می‌شوند.
   * تصویر نهایی کوچک و سبک است، چون ابزارهای توسعه و فایل‌های اضافی داخل آن نیستند.

3. **مزایا:**

   * کاهش حجم تصویر Docker
   * امنیت بهتر (چون ابزارهای توسعه تو تصویر نهایی نیستند)
   * امکان جداسازی مراحل ساخت و اجرا

---

اگر بخوای، می‌تونم یه **نسخه ساده و قابل اجرا با BusyBox و Multi-stage** هم بسازم تا کاملاً ملموس باشه و حجم تصویر واقعاً کم بشه.

میخوای این نسخه رو هم درست کنم؟
