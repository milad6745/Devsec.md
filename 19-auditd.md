 **auditd** โ
ุงู ุณุฑูุณ ุชู ูููฺฉุณ ุจุฑุง **ูุงูุชูุฑูฺฏ ู ุซุจุช ุฑุฎุฏุงุฏูุง ุงููุช** ุงุณุชูุงุฏู ูุดู (ูุซู ูุงฺฏูโูุงุ ุชุบุฑ ูุงูโูุงุ ุงุฌุฑุง ุฏุณุชูุฑูุง ู ...).
ูุชูู ุจุงูุงุด ุฑู **Docker** ูู ูุธุงุฑุช ุฏุงุดุชู ุจุงุด (ูุซู: ฺฉ container ุณุงุฎุชู ุดุฏุ ฺฉ ูพุงฺฉ ุดุฏุ ฺฉ image pull ุดุฏุ ...).

---

## ๐น ูุฑุงุญู ูุนุงูโุณุงุฒ auditd ุจุฑุง Docker

### 1. ูุตุจ auditd

ุฑู Ubuntu 23.04:

```bash
sudo apt update
sudo apt install auditd audispd-plugins -y
```

ูุนุงูโุณุงุฒ ุณุฑูุณ:

```bash
sudo systemctl enable auditd
sudo systemctl start auditd
```

---

### 2. ุงุถุงูู ฺฉุฑุฏู ููุงูู (audit rules) ุจุฑุง Docker

ููุงูู audit ุชู ูุงู `/etc/audit/rules.d/audit.rules` ุง `/etc/audit/rules.d/docker.rules` ุงุถุงูู ูุดู.

ูุซุงู ููุงูู ูพุงู ุจุฑุง Docker:

```bash
# ูุธุงุฑุช ุฑู ุงุฌุฑุง ุจุงูุฑ docker
-w /usr/bin/docker -p x -k docker

# ูุธุงุฑุช ุฑู ูุงูโูุง ูพฺฉุฑุจูุฏ docker
-w /etc/docker/ -p wa -k docker

# ูุธุงุฑุช ุฑู ุฏุงุฑฺฉุชูุฑ lib ูุฑุจูุท ุจู ฺฉุงูุชูุฑูุง
-w /var/lib/docker/ -p wa -k docker

# ูุธุงุฑุช ุฑู ุณูฺฉุช docker (ุจุฑุง ุงูฺฉู ฺฉ ูุตู ูุดู)
-w /var/run/docker.sock -p rwxa -k docker
```

ุจุนุฏ ุงุฒ ูุฑุงุด ูุงู:

```bash
sudo augenrules --load
sudo systemctl restart auditd
```

---

### 3. ูุดุงูุฏู ูุงฺฏโูุง auditd

ูุงฺฏโูุง ุชู ูุงู ุฒุฑ ุฐุฎุฑู ูุดู:

```bash
/var/log/audit/audit.log
```

ุจุฑุง ุฌุณุชุฌู ุจุง ฺฉูุฏ `docker`:

```bash
sudo ausearch -k docker
```

---

### 4. ุชุณุช

ฺฉ container ุณุงุฏู ุจุณุงุฒ:

```bash
docker run --rm alpine echo "hello"
```

ุจุนุฏ ุชู ูุงฺฏโูุง ุจุฑุฑุณ ฺฉู:

```bash
sudo ausearch -k docker | less
```

---

## ๐น ูุชุฌู

ุจุง ุงูฺฉุงุฑ:

* ูุฑ ุชุบุฑ ุฏุฑ ุฏุงุฑฺฉุชูุฑโูุง Docker
* ุงุฌุฑุง ุฏุณุชูุฑุงุช docker
* ุชุบุฑ ุฏุฑ ุชูุธูุงุช
* ุง ุฏุณุชุฑุณ ุจู `docker.sock`

ูููโุงุด ุชู auditd ุซุจุช ูุดู โ

---




`auditd`

ฺฉ **Linux Audit Framework** ูุณุช ู ูุดู ุจุงูุงุด ุชูุฑุจุงู ูุฑ ูุนุงูุช ููู ุฑู ุณุณุชู ุฑู ูุงฺฏ ฺฉุฑุฏ. ูุฎุตูุตุงู ุจุฑุง ูุงูุชูุฑูฺฏ ุงููุช ู Forensics ุนุงูู.

---

## ๐น ฺฉุงุฑูุง ฺฉู ุจุง auditd ูุดู ฺฉุฑุฏ

1. **ูุธุงุฑุช ุฑู ูุงูโูุง ู ุฏุงุฑฺฉุชูุฑโูุง**

   * ูโุชูู ุชุบุฑุงุช ุฑู ูุงูโูุง ุญุณุงุณ (ูุซูุงู `/etc/passwd` ุง `/etc/shadow`) ุฑู ูุงฺฏ ฺฉู.
   * ูุซุงู:

     ```bash
     -w /etc/passwd -p wa -k identity
     -w /etc/shadow -p wa -k auth
     ```

     โ ูุฑ ุชุบุฑ ุฑู ฺฉุงุฑุจุฑูุง ุง ูพุณูุฑุฏูุง ุซุจุช ูุดู.

---

2. **ูุธุงุฑุช ุฑู ุงุฌุฑุง ุจุฑูุงููโูุง**

   * ูโุชูู ุจุจู ฺู ฺฉุณ ฺู ุจุฑูุงููโุง ุฑู ุงุฌุฑุง ฺฉุฑุฏู.
   * ูุซุงู:

     ```bash
     -a always,exit -F arch=b64 -S execve -k exec_log
     ```

     โ ูุฑ ุจุงุฑ ฺฉ ุจุฑูุงูู ุงุฌุฑุง ุจุดูุ ูุงฺฏ ูโฺฏุฑ.

---

3. **ูุธุงุฑุช ุฑู ุฏุณุชุฑุณ ุจู ูุงูโูุง**

   * ูโุชูู ุจููู ฺฉ ูุงู ุฎุงุต ุฑู ุฎููุฏู ุง ููุดุชู.
   * ูุซุงู:

     ```bash
     -w /var/log/secure -p r -k log_access
     ```

---

4. **ูุธุงุฑุช ุฑู Network / Sockets**

   * ูุดู ุจุฑุฑุณ ฺฉุฑุฏ ฺู ฺฉุณ ุจู `docker.sock` ุง ุณูฺฉุชโูุง ุฏฺฏู ูุตู ุดุฏู.
   * ูุซุงู:

     ```bash
     -w /var/run/docker.sock -p rwxa -k docker
     ```

---

5. **ูุธุงุฑุช ุฑู ุชุบุฑุงุช ฺฉุฑูู ู ูุงฺููโูุง**

   * ุฎู ููู ุจุฑุง ุงููุช ฺฉุฑูู.
   * ูุซุงู:

     ```bash
     -w /sbin/insmod -p x -k modules
     -w /sbin/rmmod -p x -k modules
     ```

---

6. **ูุงูุชูุฑูฺฏ ูุฒุฑูุง ู sudo**

   * ุจููู ฺู ฺฉุณ `sudo` ุฒุฏู.
   * ูุซุงู:

     ```bash
     -w /etc/sudoers -p wa -k sudo
     ```

---

## ๐น ฺู ูุงฺฏโูุง ุชููุฏ ูุดูุ

ููู ฺุฒ ูุฑู ุชู:

```
/var/log/audit/audit.log
```

ุจุฑุง ุชุญูู ูโุชูู ุงุณุชูุงุฏู ฺฉู ุงุฒ:

* `ausearch` โ ุฌุณุชุฌู ูุงฺฏโูุง

  ```bash
  ausearch -k docker
  ausearch -m execve
  ```
* `aureport` โ ฺฏุฒุงุฑุดโูุง ุฎูุงุตู

  ```bash
  aureport -x   # ุงุฌุฑุง ุจุฑูุงููโูุง
  aureport -f   # ูุงูโูุง
  aureport -au  # ุงุญุฑุงุฒ ููุช
  ```

---

## ๐น ูููููโ ูุงูุน

ูุฑุถ ฺฉู ุจุฎูุง ุจุฏูู ฺฉ ูุงุฑุฏ `/etc/passwd` ุดุฏู:

1. ูุงููู ุงุถุงูู ูโฺฉู:

   ```bash
   -w /etc/passwd -p wa -k passwd_changes
   ```
2. ฺฉุณ ูุงู ุฑู ุชุบุฑ ุจุฏู.
3. ุจุฑุฑุณ ูโฺฉู:

   ```bash
   ausearch -k passwd_changes
   ```

---

ุนู `auditd` ูโุชููู ูุซู ฺฉ **ุณุณุชู SIEM ูุญู** ุจุงุดู ฺฉู ููู ูุนุงูุชโูุง ูุดฺฉูฺฉ ุฑู ูุงฺฏ ูโฺฉูู.

---

